---
layout: post
title: Kotlinå¼€å‘-3-å±æ€§ä¸åŸŸ
categories:
  - Kotlin
tags: Kotlin
keywords:
  - Kotlin
  - ç±»
  - å¯¹è±¡
  - æ„é€ å™¨
abbrlink: 12ba0671
date: 2017-06-08 00:00:00
---

æœ¬æ–‡ä¸»è¦ä»‹ç» `Kotlin` å±æ€§å’ŒåŸŸçš„ç›¸å…³å†…å®¹ã€‚


`Kotlin` ä¸­ï¼Œä½¿ç”¨ `val` å£°æ˜å¸¸é‡(ä¸å¯å˜)ï¼Œä½¿ç”¨ `var` å£°æ˜å˜é‡(å¯å˜)ã€‚

```kotlin
public val a = 100 // å¸¸é‡ï¼Œä¸å¯å˜ï¼Œå½“ä½ å†æƒ³æ”¹å˜ä»–çš„å€¼æ—¶ä¼šæŠ¥é”™
private var b = 1000 // å˜é‡ï¼Œå¯å˜
b = -100

val c:Int? = null
```

<!--more-->



## å±æ€§çš„å£°æ˜

å£°æ˜å±æ€§çš„å®Œæ•´è¯­æ³•å¦‚ä¸‹ï¼Œå…¶ä¸­çš„åˆå§‹åŒ–å™¨(`initializer`)ï¼Œ å–å€¼æ–¹æ³•(`getter`)ï¼Œ ä»¥åŠè®¾å€¼æ–¹æ³•(`setter`)éƒ½æ˜¯å¯é€‰çš„ã€‚`Kotlin` å…·æœ‰ç±»å‹è‡ªåŠ¨æ¨æ–­å¾—ç‰¹æ€§ï¼Œå¦‚æœå±æ€§ç±»å‹å¯ä»¥é€šè¿‡åˆå§‹åŒ–å™¨è‡ªåŠ¨æ¨æ–­å¾—åˆ°ï¼Œ æˆ–è€…å¯ä»¥é€šè¿‡è¿™ä¸ªå±æ€§è¦†ç›–çš„åŸºç±»æˆå‘˜å±æ€§æ¨æ–­å¾—åˆ°ï¼Œ åˆ™å±æ€§ç±»å‹çš„å£°æ˜ä¹Ÿå¯ä»¥çœç•¥ã€‚

æ ‡å‡†çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œéœ€è¦æ¸…æ¥šå…¶ä¸­å‡ ä¸ªæ¦‚å¿µ

> - `propertyName` ï¼šå˜é‡å
> - `PropertyType` ï¼šå˜é‡ç±»å‹ï¼Œå¦‚æœå¯ä»¥æ¨æ–­å¾—åˆ°ï¼Œå¯ä»¥çœç•¥
> - `property_initializer` ï¼šåˆå§‹åŒ–å™¨ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå›ºå®šå€¼æˆ–ä¸€ä¸ªè¡¨è¾¾å¼
> - `getter` ï¼šå–å€¼æ–¹æ³•ï¼Œè®¿é—®å™¨çš„ä¸€ç§
> - `setter` ï¼šè®¾å€¼æ–¹æ³•ï¼Œè®¿é—®å™¨çš„ä¸€ç§

```kotlin
var <propertyName>: <PropertyType> [= <property_initializer>]
    [<getter>]
    [<setter>]
   
```

æ³¨æ„ï¼Œå¦‚ä¸‹æ³¨é‡Š `1` å¤„ï¼Œå¯¹äº `var` å˜é‡æ¥è¯´ï¼Œåˆå§‹åŒ–å™¨ï¼Œè®¾å€¼ï¼Œå–å€¼æ–¹æ³•éƒ½æ˜¯å…è®¸åŒæ—¶å­˜åœ¨çš„ï¼›å¦‚ä¸‹æ³¨é‡Š `2` å¤„ï¼Œå¯¹äº `val` å˜é‡æ¥è¯´ï¼Œä¸å…è®¸æœ‰è®¾å€¼æ–¹æ³•ï¼ŒåŒæ—¶ `getter` æ–¹æ³•å’Œ `åˆå§‹åŒ–å™¨` ä¸å…è®¸åŒæ—¶æŒ‡å®šï¼Œå› ä¸ºåªè¯»å˜é‡åªå…è®¸åˆå§‹åŒ–ä¸€æ¬¡ã€‚

ä½¿ç”¨ **æ³¨è§£** å’Œ **å¯è§åº¦ä¿®é¥°ç¬¦**ï¼Œå¦‚ä¸‹æ³¨é‡Š `3` å¤„ï¼Œï¼Œå¦‚æœä¸æƒ³åœ¨å¤–ç•Œè®¿é—®å±æ€§çš„ `setï¼get` æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨å¯è§åº¦ä¿®é¥°ç¬¦æ¥é¿å…å¤–éƒ¨è®¿é—®ã€‚åŒæ ·ä¹Ÿå¯ä»¥åœ¨ `setï¼get` æ–¹æ³•å‰ä½¿ç”¨æ³¨è§£ã€‚


```kotlin
open class ClsA {
    // 1
    var x: Int = 100
        get() = 100
        set(value) {
            field = value
        }
        
    // 2. ä¸å…è®¸æœ‰è®¾å€¼æ–¹æ³•ï¼ŒåŒæ—¶getæ–¹æ³•å’Œåˆå§‹åŒ–å™¨ä¸å…è®¸åŒæ—¶æŒ‡å®šï¼Œå› ä¸ºåªè¯»å˜é‡åªå…è®¸åˆå§‹åŒ–ä¸€æ¬¡
    val y: Int
        get() = 100
    // è¿™æ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºvalåªè¯»çš„
    // set(value) {
    //    field = value
    // }
    
    // 3. åœ¨set/getæ–¹æ³•å‰ä½¿ç”¨å¯è§åº¦ä¿®é¥°ç¬¦å’Œæ³¨è§£
    var z: Int = 100
    @Inject get
    private set
}

eg:
val param:ClsA = ClsA()
// ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºä¸å…è®¸è®¿é—®zçš„è®¾å€¼æ–¹æ³•
param.z = 100
```

## Backing Fields  

`Kotlin` æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å±æ€§åç§°å¯¹ç±»çš„å±æ€§è¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬å¹¶æ²¡æœ‰ç›´æ¥è®¿é—®è¯¥å±æ€§çš„å¼•ç”¨ï¼Œè€Œæ˜¯åœ¨ç¼–è¯‘æ—¶è¢«è½¬æ¢æˆäº† `getter/setter` æ–¹æ³•æ¥è¿›è¡Œè®¿é—®ï¼Œå¦‚æ³¨é‡Šä¸­ `1` å¤„ä»£ç ï¼Œè¿™æ ·æˆ‘ä»¬æ—¢å¯ä»¥ç®€åŒ–ä»£ç ï¼Œåˆä¿æŒäº†ç±»çš„å°é—­æ€§ã€‚

`Kotlin` çš„ç±»ä¸­ä¸å…è®¸æ‹¥æœ‰åŸŸ(`Field`)ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åœ¨ç±»å†…éƒ¨ä¹Ÿæ— æ³•ç›´æ¥ä½¿ç”¨å±æ€§çš„åç§°å¯¹å±æ€§è¿›è¡Œè®¿é—®ï¼Œè€Œæ˜¯éƒ½ä¼šè½¬æ¢ä¸º `getter/getter` æ–¹æ³•ã€‚å› æ­¤å½“ä½ åœ¨ `set` æ–¹æ³•ä¸­è°ƒç”¨è¯¥å±æ€§ä¸ºä»–èµ‹å€¼æ—¶åˆä¼šè°ƒç”¨ `set` æ–¹æ³•ï¼Œå¯¼è‡´ **å †æ ˆæº¢å‡º**ï¼Œå¦‚å®ä¾‹ä¸­ `2`ï¼Œè¿™æ˜¯æˆ‘åœ¨å¼€å§‹å†™çš„æ—¶å€™é‡åˆ°çš„é—®é¢˜ã€‚

```kotlin
// 1 ä¼ªä»£ç 
ClsA().x = 100 ç›¸å½“äº ClsA().setX(100)
val a = ClsA.x ç›¸å½“äº val a = ClsA().getX()

// 2
var xx: Int = 100
    set(value) {
    	// å†æ¬¡è°ƒç”¨ set æ–¹æ³•
        xx = value + 1
    }
```
ä½†æ˜¯è‡ªå®šä¹‰å±æ€§çš„è®¿é—®å™¨æ—¶ä¸å¯é¿å…çš„è¦ä½¿ç”¨ åŸŸå˜é‡ï¼Œå› æ­¤ `Kotlin` æä¾›äº† `Backing Fields` çš„ç‰¹æ€§ï¼Œä½¿ç”¨å…³é”®å­— `field` è¡¨ç¤ºï¼Œ`field` æ ‡è¯†ç¬¦åªå…è®¸åœ¨å±æ€§çš„è®¿é—®å™¨å‡½æ•°å†…ä½¿ç”¨ï¼Œå¦‚ä¸‹ä»£ç ä¸­ï¼Œä½¿ç”¨ `field` å³å¯çœŸå®çš„è®¿é—®(ä¸ç»è¿‡`getter/setter`) å˜é‡ `xx`ï¼Œå®Œæˆèµ‹å€¼æ“ä½œã€‚

```kotlin
var xx: Int = 100
    get() = field++
    set(value) {
        field = value - 1
    }
```

## Backing Property

æœ‰æ—¶éšå«çš„åç«¯åŸŸå±æ€§ä¸è¶³ä»¥è§£å†³æŸäº›æƒ…å†µçš„é—®é¢˜ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ `Backing Property`ã€‚å¦‚ä¸‹å®ä¾‹ä¸­ï¼Œ`Backing Property` å°±æ˜¯å¦å¤–å®šä¹‰ä¸€ä¸ªå±æ€§ `_yy` ç”¨æ¥å­˜å‚¨æ•°æ®ï¼Œè€Œå¤–ç•Œè®¿é—®çš„å±æ€§ `yy` åªæ˜¯æä¾›äº†ä¸€ä¸ªè®¿é—®å™¨æ–¹æ³•è€Œå·²ï¼Œæœ¬èº«å·²ç»ä¸å…·å¤‡ä»€ä¹ˆæ„ä¹‰å•¦ï¼Œå°†è®¿é—®å™¨çš„å£°æ˜å’Œæ•°æ®çš„å­˜å‚¨æ”¾åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼Œå°±ä¸ä¼šå‘ç”Ÿä¹‹å‰çš„å†²çªï¼ˆæˆ‘çš„ç†è§£ğŸ˜Šï¼‰

```kotlin
private var _yy: String? = null

var yy: String
    get() {
        if (_yy == null) {
            _yy = "init str"
        }
        return _yy ?: "be changed"
    }
    set(value) {
        _yy = "this is $value"
    }
    
// è®¿é—®yy
val param: ClsA = ClsA()
param.yy
```

## ç¼–è¯‘æœŸå¸¸æ•°

å¦‚æœå±æ€§å€¼åœ¨ç¼–è¯‘æœŸé—´å°±èƒ½ç¡®å®š, åˆ™å¯ä»¥ä½¿ç”¨ `const` ä¿®é¥°ç¬¦, å°†å±æ€§æ ‡è®°ä¸º **ç¼–è¯‘æœŸå¸¸æ•°å€¼(`compile time constants`)**ã€‚ è¿™ç±»å±æ€§å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶:

> - å¿…é¡»æ˜¯é¡¶çº§å±æ€§ï¼Œ æˆ–è€…æ˜¯ä¸€ä¸ª `object` çš„æˆå‘˜ã€‚
> - å€¼è¢«åˆå§‹åŒ–ä¸º `String` ç±»å‹, æˆ–åŸºæœ¬ç±»å‹(`primitive type`)ã€‚
> - ä¸å­˜åœ¨è‡ªå®šä¹‰çš„å–å€¼æ–¹æ³•ã€‚

```kotlin
// é¡¶çº§å±æ€§
const val TEST_CONST = "TEST_CONST"

// å£°æ˜åœ¨ object ä¸­
object Const{
    const val TEST_CONST_IN_OBJ = "TEST_CONST_IN_OBJ"
}
```

## å±æ€§åˆå§‹åŒ– - å»¶è¿Ÿ(lateinit)

`lateinit` å…³é”®å­—è¡¨ç¤ºå½“å‰ å˜é‡ ä¸ä¼šåœ¨å£°æ˜æ—¶è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œåˆå§‹åŒ–æ“ä½œä¼šåœ¨åé¢è¿›è¡Œï¼Œåƒæ˜¯ä¸€ç§åè®®æœºåˆ¶ï¼Œå‘ŠçŸ¥ç¼–è¯‘å™¨æˆ‘ä¼šåœ¨åé¢ä½¿ç”¨è¯¥å˜é‡ä¹‹å‰çš„æ°å½“æ—¶æœºåˆå§‹åŒ–è¯¥å˜é‡ï¼Œä¸è¦è¿›è¡Œè­¦å‘Šâš ï¸ã€‚åœ¨ä¸€ä¸ª `lateinit` å±æ€§è¢«åˆå§‹åŒ–ä¹‹å‰è®¿é—®å®ƒï¼Œ ä¼šæŠ›å‡ºä¸€ä¸ªç‰¹åˆ«çš„å¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸å°†ä¼šæŒ‡æ˜è¢«è®¿é—®çš„å±æ€§ï¼Œä»¥åŠå®ƒæ²¡æœ‰è¢«åˆå§‹åŒ–è¿™ä¸€é”™è¯¯ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨ `lateinit` å…³é”®å­—æœ‰å¾ˆå¤šé™åˆ¶:

> - å¿…é¡»æ˜¯å˜é‡ï¼Œå³ä½¿ç”¨ `var` å…³é”®å­—è¿›è¡Œå£°æ˜ã€‚   
> - ä¸èƒ½ä¿®é¥°å¯ä¸º `null` çš„ç±»å‹ï¼Œæ¯”å¦‚ `lateinit var str:String?` æ˜¯ç¼–è¯‘ä¸é€šè¿‡çš„ã€‚   
> - ä¸èƒ½ä¿®é¥°åŸºæœ¬æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚ `Int`,`Float`ç­‰

```kotlin
lateinit var stuLateInit:Student

stuLateInit = Student("name",11)
```


## å±æ€§å»¶è¿Ÿåˆå§‹åŒ– - ä»£ç†(by lazy)

`by lazy` æ˜¯å±æ€§ä»£ç†çš„åŸºæœ¬è¿ç”¨ï¼Œæ˜¯ç»è¿‡ç®€åŒ–åçš„å±æ€§ä»£ç†ï¼Œä»–ä¸ºå±æ€§æä¾›åˆå§‹åŒ–æ–¹æ³•ã€‚è¿™é‡Œä¸æ‰©å±•å±æ€§ä»£ç†çš„ç›¸å…³é—®é¢˜ã€‚

å› ä¸ºä»–åªæä¾›å–å€¼æ–¹æ³•æ‰€ä»¥ä»…å¯ä»¥ç”¨åœ¨å¸¸é‡çš„åˆå§‹åŒ–ä¸­ï¼Œä½¿ç”¨ `by lazy` å½“å±æ€§è¢«ç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œå°±ä¼šè§¦å‘åˆå§‹åŒ–æµç¨‹ã€‚

> - åªæœ‰å¸¸é‡ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ `val`æ‰èƒ½ä½¿ç”¨ `by lazy` å»¶è¿Ÿåˆå§‹åŒ–

```kotlin
val stuByLazy:Student by lazy {
    Student("name",11)
}

val mMyMsgTv:TextView by lazy {
    findViewById(R.id.mTestTv) as TextView
}

// å½“å¸¸é‡è¢«ä½¿ç”¨æ—¶æ‰è¿›è¡Œåˆå§‹åŒ–
logError(stuByLazy.myCls)
mMyMsgTv.text="æ–‡æœ¬"
```